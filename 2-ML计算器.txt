<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“±MLå®šä»·è®¡ç®—å™¨-GOLDKINGğŸ¤</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: white;
            margin: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 800px;
        }
        .section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            border: 1px solid #eee;
        }
        h2 {
            color: #333;
            margin: 0 0 20px 0;
            font-size: 1.4em;
            text-align: center;
        }
        .input-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .input-group {
            margin-bottom: 0;
        }
        label {
            display: block;
            margin-bottom: 6px;
            color: #666;
            font-size: 0.9em;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.2s;
            margin-bottom: 10px;
        }
        .calculate-btn {
            background: #4CAF50;
            color: white;
        }
        .template-btn {
            background: #2196F3;
            color: white;
        }
        #results table {
            width: 100%;
            margin-top: 20px;
            font-size: 0.9em;
            border-collapse: collapse;
        }
        #results th, 
        #results td {
            padding: 10px;
            border: 1px solid #eee;
            text-align: center;
            vertical-align: middle;
        }
        #results th {
            background: #f8f9fa;
        }
        .currency {
            font-weight: bold;
            color: #2e7d32;
        }
        .profit {
            font-weight: bold;
            color: #2e7d32;
        }
        .flag {
            font-size: 1.1em;
        }
        .progress-bar {
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #4CAF50;
            width: 50%;
        }
        .upload-wrapper {
            position: relative;
            margin: 15px 0;
        }
        #shippingFile {
            opacity: 0;
            position: absolute;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .custom-upload {
            background: #2196F3;
            color: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-size: 0.9em;
        }
        .collapse {
            margin-top: 20px;
        }
        .collapse-header {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .collapse-content {
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            margin-top: 10px;
        }
        .exchange-rate {
            width: 70px;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- è®¡ç®—å™¨æ¨¡å— -->
        <div class="section">
            <h2>ğŸ“± Mercado Libre å®šä»·è®¡ç®—å™¨-GOLDKINGğŸ¤</h2>
            <form onsubmit="event.preventDefault();calculatePrice()">
                <div class="input-row">
                    <div class="input-group">
                        <label>ğŸ’° äº§å“æˆæœ¬ (CNY)</label>
                        <input type="number" id="cost" step="0.01" required>
                    </div>
                    <div class="input-group">
                        <label>ğŸ“¦ é‡é‡ (kg)</label>
                        <input type="number" id="weight" step="0.01" required>
                    </div>
                    <div class="input-group">
                        <label>ğŸ¯ åˆ©æ¶¦ç‡ (%)</label>
                        <input type="number" id="profitMargin" value="18" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>ğŸ¤ ä½£é‡‘ç‡ (%)</label>
                        <input type="number" id="commissionRate" value="18.5" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>ğŸ’± æ±‡ç‡ (USD/CNY)</label>
                        <input type="number" id="exchangeRate" value="7.2" step="0.01">
                    </div>
                </div>
                <button type="submit" class="calculate-btn">ğŸ’° ç«‹å³è®¡ç®— ğŸ’°</button>
            </form>
            <div id="results"></div>
        </div>

        <!-- è¿è´¹æ¨¡æ¿æ¨¡å— -->
        <div class="section">
            <h2>âœˆï¸ è¿è´¹æ¨¡æ¿ç®¡ç†(ç”¨äºæ›´æ–°æ–°çš„è¿è´¹) âœˆï¸</h2>
            <div class="upload-wrapper">
                <input type="file" id="shippingFile" accept=".xlsx">
                <div class="custom-upload">ğŸ“¤ ä¸Šä¼ è¿è´¹æ¨¡æ¿ (.xlsx)</div>
            </div>
            <button class="template-btn" onclick="exportTemplate()">ğŸ“¥ ä¸‹è½½è¿è´¹æ¨¡æ¿ (.xlsx)</button>
        </div>

        <!-- åŒ…è£¹å°ºå¯¸é™åˆ¶æ¨¡å— -->
        <div class="section">
            <div class="collapse">
                <div class="collapse-header" onclick="toggleCollapse()">
                    <span>ğŸ“¦ å„ç«™ç‚¹åŒ…è£¹å°ºå¯¸/é‡é‡é™åˆ¶ âš ï¸ â€”â€”â€”â€” ä¸åŒ…é‚®çš„æ¯å•ä½é™„åŠ è´¹ğŸ¤</span>
                    <span id="collapseToggle">â–²</span>
                </div>
                <div class="collapse-content" id="collapseContent" style="display: block;">
                    <div id="sizeLimits">
                        <h3>é’ˆå¯¹ä¸åŒ…é‚®å•†å“(ä¹°å®¶æ‰¿æ‹…è¿è´¹)ï¼Œæ¯å¢åŠ 1å•ä½ä¼šæ”¶å–é™„åŠ è´¹</h3>
                        <p><strong>æ¯å•ä½é™„åŠ è´¹è¯´æ˜:</strong><br>ğŸ‡²ğŸ‡½å¢¨è¥¿å“¥:å”®ä»·ä½äº299 MXN(ä¹°å®¶æ”¯ä»˜è¿è´¹)<br>å½“ä¹°å®¶è´­ä¹°å¤šä»¶äº§å“æ—¶å°†æ”¶å–æ¯å•ä½é¢å¤–å›ºå®šæˆæœ¬ï¼šMXN $33</p>
<br>ğŸ‡§ğŸ‡·å·´è¥¿:å”®ä»·ä½äº79 BRL(ä¹°å®¶æ”¯ä»˜è¿è´¹)<br>å½“ä¹°å®¶è´­ä¹°å¤šä»¶äº§å“æ—¶å°†æ”¶å–æ¯å•ä½é¢å¤–å›ºå®šæˆæœ¬ï¼šBRL $9.5</p>
<br>ğŸ‡¨ğŸ‡±æ™ºåˆ©:å”®ä»·ä½äº15650 CLP(ä¹°å®¶æ”¯ä»˜è¿è´¹)<br>å½“ä¹°å®¶è´­ä¹°å¤šä»¶äº§å“æ—¶å°†æ”¶å–æ¯å•ä½é¢å¤–å›ºå®šæˆæœ¬ï¼šCLP $1650</p>
<br>ğŸ‡¨ğŸ‡´å“¥ä¼¦æ¯”äºš:å”®ä»·ä½äº60000 COP(ä¹°å®¶æ”¯ä»˜è¿è´¹)<br>å½“ä¹°å®¶è´­ä¹°å¤šä»¶äº§å“æ—¶å°†æ”¶å–æ¯å•ä½é¢å¤–å›ºå®šæˆæœ¬ï¼šCOP $7200<br></p>
ğŸ‡¦ğŸ‡·é˜¿æ ¹å»·:å”®ä»·ä½äº30000 ARS(ä¹°å®¶æ”¯ä»˜è¿è´¹)<br>å½“ä¹°å®¶è´­ä¹°å¤šä»¶äº§å“æ—¶å°†æ”¶å–æ¯å•ä½é¢å¤–å›ºå®šæˆæœ¬ï¼šARS $1800</p>

                        <h3>ğŸ‡²ğŸ‡½ MX</h3>
                        <p><strong>MailAmericas:</strong><br>æœ€å¤§å°ºå¯¸(é«˜xå®½xé•¿): 40Ã—50Ã—60å˜ç±³<br>æœ€å°é‡é‡ï¼š100å…‹<br>æœ€å¤§é‡é‡ï¼š15å…¬æ–¤</p>
                        <p><strong>Cainiao:</strong><br>æ¯è¾¹é•¿åº¦ï¼šæœ€å¤§60å˜ç±³<br>ä¸‰è¾¹æ€»å’Œçš„é•¿åº¦ï¼šæœ€å¤§90å˜ç±³<br>æœ€å¤§é‡é‡ï¼š5å…¬æ–¤</p>

                        <h3>ğŸ‡§ğŸ‡· BR</h3>
                        <p><strong>ANJUN:</strong><br>æœ€å°å°ºå¯¸ï¼ˆé«˜ x å®½ x é•¿ï¼‰ï¼š1 x 10 x 15 å˜ç±³<br>æœ€å¤§å°ºå¯¸ï¼ˆé«˜+å®½+é•¿ä¸è¶…è¿‡200å˜ç±³ï¼‰ï¼š<br>æœ€å¤§å°ºå¯¸ï¼ˆé•¿åº¦ã€å®½åº¦æˆ–é«˜åº¦ï¼‰ä¸å¾—è¶…è¿‡ 100 å˜ç±³ï¼Œå¹¶ä¸”<br>ç¬¬äºŒå¤§å°ºå¯¸ä¸å¾—è¶…è¿‡ 90 å˜ç±³<br>å°ºå¯¸æ€»å’Œä¸å¾—è¶…è¿‡ 200 å˜ç±³<br>æœ€å¤§é•¿åº¦ï¼š16 å˜ç±³<br>æœ€å°é•¿åº¦ï¼š11 å˜ç±³<br>æœ€å¤§é‡é‡ï¼š30å…¬æ–¤</p>

                        <h3>ğŸ‡¨ğŸ‡± CL</h3>
                        <p><strong>MailAmericas:</strong><br>æœ€å¤§å°ºå¯¸(é«˜+å®½+é•¿ä¸è¶…è¿‡2ç±³):<br>æ¯è¾¹ä¸è¶…è¿‡1.05ç±³<br>æœ€å¤§é‡é‡ï¼š15å…¬æ–¤</p>

                        <h3>ğŸ‡¨ğŸ‡´ CO</h3>
                        <p><strong>MailAmericas:</strong><br>æœ€å¤§å°ºå¯¸(é«˜+å®½+é•¿ä¸è¶…è¿‡2ç±³):<br>æ¯è¾¹ä¸è¶…è¿‡1.05ç±³<br>æœ€å°é‡é‡ï¼š1å…‹<br>æœ€å¤§é‡é‡ï¼š25å…¬æ–¤</p>
                        <p><strong>Cainiao:</strong><br>æ¯è¾¹é•¿åº¦ï¼šæœ€å¤§60å˜ç±³<br>ä¸‰è¾¹æ€»å’Œçš„é•¿åº¦ï¼šæœ€å¤§90å˜ç±³<br>æœ€å¤§é‡é‡ï¼š2å…¬æ–¤</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script>
        // å®Œæ•´è¿è´¹æ•°æ®å­˜å‚¨ç»“æ„
        let shippingRates = {
            MX: createRanges(0.1, [3.40,4.59,5.83,7.28,8.48,10.10,11.46,12.62,13.88,14.75,18.64,25.80,44.23,51.72,60.33,76.23,92.12,108.01,123.90,139.79,155.69,171.58,187.47,203.36,219.25]),
            BR: createRanges(0.1, [4.63,5.50,8.31,8.60,10.93,11.30,13.43,13.63,16.10,16.47,20.06,26.37,39.42,42.56,52.44,79.67,97.90,111.26,124.62,137.98,151.35,164.71,178.07,191.43,204.79]),
            CL: createRanges(0.1, [3.99,5.03,6.35,7.85,9.13,10.01,11.22,11.79,13.34,13.97,18.47,25.06,46.11,55.18,68.98,82.68,96.38,110.08,123.78,137.48,151.18,164.88,178.58,192.28,205.98]),
            CO: createRanges(0.1, [3.80,5.07,6.31,8.11,8.73,10.97,11.70,12.33,12.95,13.64,18.85,26.08,43.79,57.19,67.49,79.45,95.08,110.84,126.59,142.35,158.11,173.86,189.62,205.37,221.13])
        };

        // è´§å¸è½¬æ¢è¡¨ï¼ˆç¤ºä¾‹ï¼Œä»…åŒ…å«éƒ¨åˆ†å›½å®¶ï¼‰
        const currencySymbols = {
            MX: "MXN",
            BR: "BRL",
            CL: "CLP",
            CO: "COP"
        };

        let countryExchangeRates = {
            MX: 19.9,
            BR: 5.3,
            CL: 800,
            CO: 4000
        };

        // ç”ŸæˆèŒƒå›´æ•°æ®çš„å·¥å…·å‡½æ•°
        function createRanges(step, rates) {
            let ranges = [];
            let current = 0;
            for(let rate of rates) {
                ranges.push({
                    min: current,
                    max: current + step,
                    rate: rate
                });
                current += step;
                if(current >= 1) step = current < 2 ? 0.5 : 1;
            }
            return ranges;
        }

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('shippingFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                processExcel(new Uint8Array(e.target.result));
                alert('è¿è´¹æ•°æ®æ›´æ–°æˆåŠŸï¼');
            };
            reader.readAsArrayBuffer(file);
        });

        // å¤„ç†Excelæ•°æ®
        function processExcel(data) {
            const workbook = XLSX.read(data, {type: 'array'});
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(sheet, {header: 1});

            let currentCountry = null;
            let ranges = [];
            
            rows.forEach(row => {
                if(row[0] && row[0].startsWith('è¿è´¹è¡¨ - ')) {
                    if(currentCountry) {
                        shippingRates[currentCountry] = ranges;
                        ranges = [];
                    }
                    currentCountry = row[0].split(' - ')[1];
                }
                else if(row[0] && row[0].includes(' - ') && !isNaN(row[1])) {
                    const [min, max] = row[0].split(' - ').map(parseFloat);
                    ranges.push({min, max, rate: parseFloat(row[1])});
                }
            });
            
            if(currentCountry) {
                shippingRates[currentCountry] = ranges;
            }
        }

        // å¯¼å‡ºæ¨¡æ¿
        function exportTemplate() {
            const workbook = XLSX.utils.book_new();
            const sheetData = [];
            
            Object.keys(shippingRates).forEach(country => {
                sheetData.push([`è¿è´¹è¡¨ - ${country}`]);
                sheetData.push(['é‡é‡èŒƒå›´ (kg)', 'è¿è´¹ (USD)']);
                shippingRates[country].forEach(range => {
                    sheetData.push([`${range.min.toFixed(1)} - ${range.max.toFixed(1)}`, range.rate]);
                });
                sheetData.push([], []);
            });
            
            const worksheet = XLSX.utils.aoa_to_sheet(sheetData);
            XLSX.utils.book_append_sheet(workbook, worksheet, 'è¿è´¹æ¨¡æ¿');
            XLSX.writeFile(workbook, 'å›½é™…è¿è´¹æ¨¡æ¿.xlsx');
        }

        // è®¡ç®—æ ¸å¿ƒé€»è¾‘
        function calculatePrice() {
            const inputs = getInputValues();
            if(!validateInputs(inputs)) return;

            let html = `<table>
                <tr>
                    <th>ğŸ‡¨ğŸ‡³å›½å®¶ğŸ‡¨ğŸ‡³</th>
                    <th>ğŸ’°å®šä»·ğŸ’°</th>
                    <th>âœˆï¸è¿è´¹âœˆï¸</th>
                    <th>ğŸ¤ä½£é‡‘ğŸ¤</th>
                    <th>ğŸ“ˆåˆ©æ¶¦ğŸ“ˆ</th>
                    <th>ğŸ”åˆ©æ¶¦ç‡ğŸ”</th>
                </tr>`;

            Object.keys(shippingRates).forEach(country => {
                const shippingUSD = getShippingCost(inputs.weight, country);
                const result = calculateFinalPrice(inputs, shippingUSD);
                
                html += `<tr>
                    <td>
                        ${getCountryFlag(country)} ${country}<br>
                        <label style="font-size: 0.8em;">${currencySymbols[country]}/USD:</label>
                        <input type="number" class="exchange-rate" id="exchangeRate${country}" value="${countryExchangeRates[country]}" step="0.01" onchange="updateExchangeRate('${country}', this.value)">
                    </td>
                    <td class="currency">$ ${result.priceUSD}<br>Â¥ ${result.priceCNY}<br>${currencySymbols[country]} ${(result.priceUSD * countryExchangeRates[country]).toFixed(2)}</td>
                    <td>$ ${shippingUSD.toFixed(2)}<br>Â¥ ${(shippingUSD*inputs.exchangeRate).toFixed(2)}<br>${currencySymbols[country]} ${(shippingUSD * countryExchangeRates[country]).toFixed(2)}</td>
                    <td>$ ${result.commissionUSD}<br>Â¥ ${result.commissionCNY}<br>${currencySymbols[country]} ${(result.commissionUSD * countryExchangeRates[country]).toFixed(2)}</td>
                    <td class="profit">$ ${result.profitUSD}<br>Â¥ ${result.profitCNY}<br>${currencySymbols[country]} ${(result.profitUSD * countryExchangeRates[country]).toFixed(2)}</td>
                    <td><div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width:${Math.abs(result.profitMargin*100)}%"></div>
                        </div>
                        <div>${(result.profitMargin*100).toFixed(1)}%</div>
                    </div></td>
                </tr>`;
            });

            html += '</table>';
            document.getElementById('results').innerHTML = html;
        }

        // è¾…åŠ©å‡½æ•°
        function getInputValues() {
            return {
                cost: parseFloat(document.getElementById('cost').value),
                weight: parseFloat(document.getElementById('weight').value),
                profitMargin: parseFloat(document.getElementById('profitMargin').value) / 100,
                commissionRate: parseFloat(document.getElementById('commissionRate').value) / 100,
                exchangeRate: parseFloat(document.getElementById('exchangeRate').value)
            };
        }

        function validateInputs(inputs) {
            return !isNaN(inputs.cost) && !isNaN(inputs.weight);
        }

        function getShippingCost(weight, country) {
            return shippingRates[country].find(r => weight > r.min && weight <= r.max)?.rate || 0;
        }

        function calculateFinalPrice(inputs, shippingUSD) {
            const costUSD = inputs.cost / inputs.exchangeRate;
            const priceUSD = (costUSD + shippingUSD) / (1 - inputs.profitMargin - inputs.commissionRate);
            return {
                priceUSD: priceUSD.toFixed(2),
                priceCNY: (priceUSD * inputs.exchangeRate).toFixed(2),
                commissionUSD: (priceUSD * inputs.commissionRate).toFixed(2),
                commissionCNY: (priceUSD * inputs.commissionRate * inputs.exchangeRate).toFixed(2),
                profitUSD: (priceUSD * inputs.profitMargin).toFixed(2),
                profitCNY: (priceUSD * inputs.profitMargin * inputs.exchangeRate).toFixed(2),
                profitMargin: inputs.profitMargin
            };
        }

        function getCountryFlag(code) {
            const flags = {MX: 'ğŸ‡²ğŸ‡½', BR: 'ğŸ‡§ğŸ‡·', CL: 'ğŸ‡¨ğŸ‡±', CO: 'ğŸ‡¨ğŸ‡´'};
            return flags[code] || 'ğŸŒ';
        }

        function updateExchangeRate(country, value) {
            countryExchangeRates[country] = parseFloat(value);
            calculatePrice();
        }

        // ä¿®æ”¹åçš„æŠ˜å é¢æ¿åˆ‡æ¢åŠŸèƒ½
        function toggleCollapse() {
            const content = document.getElementById('collapseContent');
            const toggle = document.getElementById('collapseToggle');
            if(content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = 'â–²';
            } else {
                content.style.display = 'none';
                toggle.textContent = 'â–¼';
            }
        }
    </script>
</body>
</html>